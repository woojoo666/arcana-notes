<html>

<body>
	<pre id="log"></pre>

	<script src="FloModule.js"></script>

	<!-- overload console.log to output it to the page as well -->
	<script>
	console.log = (function (old_function, div_log) { 
		return function (text) {
			old_function(text);
			div_log.textContent += text + '\n';
		};
	} (console.log.bind(console), document.getElementById("log")));
	</script>

	<!-- tests -->
	<script>
	var test = new FloModule();

	// basic tests
	test.set('a', 5);
	test.set('b', 10);
	test.bind('c', ['a', 'b'], (a,b) => a+b);
	console.log(test.get('c'));
	test.set('b', 12);
	console.log(test.get('c'));

	// collection binding
	test.set('ar', [1,2,3]);

	// map bind
	test.bind('devnull', ['ar'], function (ar) {
		test.set('ar2',[]);
		ar.forEach((_, i) => test.bind('ar2.'+i, ['ar.'+i], val => val*val));
	});

	// reduce bind
	test.bind('devnull', ['ar2'], function (ar) {
		var triggers = ar.map((x,i) => 'ar2.' + i);
		test.bind('ar2sum', triggers, () => ar.reduce((acc, val) => acc+val, 0));
	});

	console.log(test.get('ar2sum'));
	test.set('ar.2', 5);
	console.log(test.get('ar2sum'));
	test.set('ar.3', 5);
	console.log(test.get('ar2sum'));
	test.set('ar', [4,5]);
	console.log(test.get('ar2sum'));
	</script>
</body>

</html>
