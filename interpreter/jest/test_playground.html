<!-- This file just contains a playground and tests for debugging jest tests -->

<html>
<head>
	<script src="../node_modules/nearley/lib/nearley.js"></script>
	<script src="../node_modules/moo/moo.js" ></script>
	<script>window.FIREFLY_VERBOSE = true</script>
	<script type="module" defer>
		import { Interpreter, NumberNode, Scope } from '../interpreter.js';
		import { validateCollector, getItems } from './utils.js';

		const interpret = src => new Interpreter(src).interpretTest();
		const expect = val => ({
			toEqual: expected => console.assert(val === expected, 'ERROR'),
			not: { toEqual: expected => console.assert(val !== expected, 'ERROR'), toContain: expected => console.assert(!val.includes(expected), 'ERROR') },
			toContain: expected => console.assert(val.includes(expected), 'ERROR'),
			toHaveLength: expected => console.assert(val.length == expected, 'ERROR'),
		});

		// normal interpreter tests here

		fetch('../starter-pack.owo').then(response => response.text()).then(starterPackSrc => {

			const webUtilsSrc = `
			serve: ()
			`;
			
			class VirtualObject extends Node {
				
			}
			
			let starterPack = new Interpreter(starterPackSrc).interpretTest();
			let webStarterPack = new Interpreter(webUtilsSrc).interpretTest(starterPack.scope);

			let environment = webStarterPack.scope; // use the starter pack as the outer scope
			
			function interpret (src) {
				const output = new Interpreter(src).interpretTest(environment, 'Indent');
				let numServers = output.listItems.size;
				if (numServers != 1) {
					throw Error(`please define exactly one server. Got ${numServers}`); // currently we only support one server
				} else {
					registerServerNode(output.listItems[0]);
				}
			}
			
			interpret(`
				serve
					index: "foo"
			`);
		});

	</script>
	<script type="module" defer>
		import { parse } from '../parser.js';

		// parser test shere
	</script>
</head>
<body>
</body>
</html>
